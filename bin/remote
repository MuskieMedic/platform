#!/usr/bin/env python

import argparse
import logging

from syncloud.app import main
from syncloud.app import logger

from syncloud.insider.facade import get_insider
from syncloud.remote.remoteaccess import RemoteAccess


def create_args_parser():
    parser = argparse.ArgumentParser(description='Remote SSH access control tool')

    subparsers = parser.add_subparsers(help='available commands', dest='action')
    parser.add_argument('--debug', action='store_true')

    subparsers.add_parser('enable', help="enable remote access")
    subparsers.add_parser('add_certificate', help="adding new certificate")
    subparsers.add_parser('disable', help="disable remote access")

    return parser

if __name__ == '__main__':

    parser = create_args_parser()
    args = parser.parse_args()

    console = True if args.debug else False
    level = logging.DEBUG if args.debug else logging.INFO
    logger.init(level, console, '/var/log/syncloud-remote.log')

    remote_access = RemoteAccess(get_insider())

    main.execute(remote_access, args)